<div class="container">
  <h1 class="h1" style="text-align:left; margin-bottom:14px;">ประวัติการซื้อ</h1>

  <% if (orders.length === 0) { %>
    <div class="card" style="padding:18px;">
      <div class="muted">ยังไม่มีประวัติการซื้อ</div>
    </div>
  <% } else { %>
    <% orders.forEach(o => { %>
      <div class="card" style="padding:16px; margin-bottom:14px;">
        <div style="display:flex; justify-content:space-between; flex-wrap:wrap; gap:10px;">
          <div>
            <div style="font-weight:900;">ออเดอร์ #<%= o.id %></div>
            <div class="muted" style="font-size:13px;">
              วันที่: <%= new Date(o.created_at).toLocaleString("th-TH") %>
            </div>
          </div>
          <div class="badge">รวม: <b><%= Number(o.total).toFixed(2) %></b> ฿</div>
        </div>

        <hr class="sep" />

        <table class="table">
          <thead>
            <tr>
              <th>สินค้า</th>
              <th class="right">ราคา</th>
              <th class="right">จำนวน</th>
              <th class="right">รวม</th>
            </tr>
          </thead>
          <tbody>
            <% (itemsByOrder[o.id] || []).forEach(it => { %>
              <tr>
                <td>
                  <div style="display:flex; gap:10px; align-items:center;">
                    <img class="item-img" src="<%= it.image_url %>" alt="">
                    <div style="font-weight:800;"><%= it.name %></div>
                  </div>
                </td>
                <td class="right"><%= Number(it.price_each).toFixed(2) %></td>
                <td class="right"><%= it.qty %></td>
                <td class="right"><%= (Number(it.price_each)*Number(it.qty)).toFixed(2) %></td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    <% }) %>
  <% } %>
</div>
